################################################################################
# Board: MKS Robin Nano-S v1.3 with extruder plugged to E1
# Config by ODUCCEU
################################################################################
# WARNING! DO NOT EDIT THIS FILE!
# To override settings from this file, you can copy and paste the relevant
# sections into your printer.cfg and change it there.
################################################################################

# Documentation
# https://www.klipper3d.org/Config_Reference.html

################################################################################
# Firmware Configuration for MKS Robin Nano v1.3 / MKS Robin Nano-S v1.3
################################################################################

# Reference
# https://github.com/KevinOConnor/klipper/blob/master/config/generic-mks-robin-nano-v1.cfg
# 
# ——————————————————————————————————————————————————————————————————————————————
#                          Klipper Firmware Configuration
# ——————————————————————————————————————————————————————————————————————————————
# [*] Enable extra low-level configuration options
#     Micro-controller Architecture (STMicroelectronics STM32)  --->
#     Processor model (STM32F407)  --->
#     Bootloader offset (32KiB bootloader)  --->
#     Clock Reference (8 MHz crystal)  --->
#     Communication interface (Serial (on USART3 PB11/PB10))  --->
# (250000) Baud rate for serial port
# [ ] Specify a custom step pulse duration
# ()  GPIO pins to set at micro-controller startup
# ——————————————————————————————————————————————————————————————————————————————
# 
# Select "Communication interface (Serial (on USART3 PB11/PB10))" for USB connection
# Select "Communication interface (Serial (on USART1 PA10/PA9))" for UART using WiFi slot
# 
# Note that the "make flash" command does not work with MKS Robin boards.
# After running "make", no need to run py script, just rename the firmware file:
# mv ~/klipper/out/klipper.bin ~/klipper/out/Robin_nano35.bin
# Copy the file out/Robin_nano35.bin to an SD card and then restart the
# printer with that SD card inserted.

################################################################################
# Pin Definitions for MKS Robin Nano v1.3 / MKS Robin Nano-S v1.3
################################################################################

# Reference for MKS Robin Nano v1.3
# https://github.com/makerbase-mks/MKS-Robin-Nano-V1.X/blob/master/hardware/MKS%20Robin%20Nano%20V1.3_002/MKS%20Robin%20Nano%20V1.3_002%20PIN.pdf

# Reference for MKS Robin Nano-S v1.3
# https://github.com/makerbase-mks/MKS-Robin-Nano-V1.X/blob/master/hardware/MKS%20Robin%20Nano-S%20V1.3_001/MKS%20Robin%20Nano-S%20V1.3_001%20PIN.pdf

## X_STEP               PE3
## X_DIR                PE2
## X_ENABLE             PE4
## X_STOP               PA15

## Y_STEP               PE0
## Y_DIR                PB9
## Y_ENABLE             PE1
## Y_STOP               PA12

## Z_STEP               PB5
## Z_DIR                PB4
## Z_ENABLE             PB8
## Z_MIN_STOP           PA11
## Z_MAX_STOP           PC4

## E0_STEP              PD6
## E0_DIR               PD3
## E0_ENABLE            PB3

## E1_STEP              PA6     # Z1_STEP
## E1_DIR               PA1     # Z1_DIR
## E1_ENABLE            PA3     # Z1_ENABLE

## HE0                  PC3
## HE1                  PB0     # HE0_FAN
## BED                  PA0
## TH1 (HE0 Temp)       PC1
## TH2 (HE1 Temp)       PC2
## TB  (BED Temp)       PC0

## FAN                  PB1

## MT_DET1              PA4
## MT_DET2              PE6
## PW_DET               PA2
## PB2                  PB2

## SERVO                PA8
## BEEPER               PC5

## WiFi_IO0             P13
## WiFi_IO1             PC7
## WiFi_TX              PA9
## WiFi_RX              PA10

## USB_TX               PB10
## USB_RX               PB11

################################################################################
# Pin Aliases
################################################################################

[board_pins mks_rn_13]
aliases:
## Steppers ####################################################################
  X_STEP_PIN=PE3, X_DIR_PIN=PE2, X_ENABLE_PIN=PE4, X_STOP_PIN=PA15, 
  Y_STEP_PIN=PE0, Y_DIR_PIN=PB9, Y_ENABLE_PIN=PE1, Y_STOP_PIN=PA12, 
  Z_STEP_PIN=PB5, Z_DIR_PIN=PB4, Z_ENABLE_PIN=PB8, Z_STOP_PIN=PA11, 
  Z1_STEP_PIN=PD6, Z1_DIR_PIN=PD3, Z1_ENABLE_PIN=PB3, Z1_STOP_PIN=PC4, 
  E0_STEP_PIN=PA6, E0_DIR_PIN=PA1, E0_ENABLE_PIN=PA3, 
## Heaters #####################################################################
  E_HEATER_PIN=PC3, E_SENSOR_PIN=PC1, 
  BED_HEATER_PIN=PA0, BED_SENSOR_PIN=PC0, 
## Fans ########################################################################
  HEATER_FAN_PIN=PB0,
  PARTCOOLING_FAN_PIN=PB1, 
## Controls ####################################################################
  MT_DET1_PIN=PA4, MT_DET2_PIN=PE6, 
  PW_DET_PIN=PA2, AUTO_OFF_PIN=PB2, 
## BLTouch #####################################################################
  BLTOUCH_SENSOR_PIN=PE6,                                                       # MT_DET2
  BLTOUCH_CONTROL_PIN=PA8,                                                      # SERVO
## TMC2209 UART ################################################################
  TMC_UART_PIN=PA1, TMC_TX_PIN=PA6, 

################################################################################
# MCU
################################################################################

[mcu]
serial: /dev/serial/by-id/usb-1a86_USB_Serial-if00-port0                        # USB
restart_method: command

################################################################################
# Sensors
################################################################################

[temperature_sensor board]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[filament_switch_sensor filament_sensor]
switch_pin: PA4
runout_gcode:
    BEEP P=1500

################################################################################
# Beeper
################################################################################

[output_pin _BEEPER_pin]
pin: PC5
pwm: True
value: 0
shutdown_value: 0
cycle_time: 0.001

################################################################################
